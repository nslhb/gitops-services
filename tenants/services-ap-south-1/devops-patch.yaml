apiVersion: kustomize.toolkit.fluxcd.io/v1beta1
kind: Kustomization
metadata:
  name: kube-system
  namespace: flux-system
spec:
  patchesStrategicMerge:
    - apiVersion: helm.toolkit.fluxcd.io/v2beta1
      kind: HelmRelease
      metadata:
        name: aws-load-balancer-controller
        namespace: kube-system
      spec:
        values:
          serviceAccount:
            annotations:
              eks.amazonaws.com/role-arn: arn:aws:iam::832807087073:role/load-balancer-ap-south-1
          image:
            repository: 602401143452.dkr.ecr.ap-south-1.amazonaws.com/amazon/aws-load-balancer-controller
    - apiVersion: v1
      kind: ServiceAccount
      metadata:
        annotations:
          eks.amazonaws.com/role-arn: arn:aws:iam::832807087073:role/cluster-autoscaler-ap-south-1
        name: cluster-autoscaler
        namespace: kube-system
    - apiVersion: v1
      kind: ServiceAccount
      metadata:
        name: external-dns
        annotations:
          eks.amazonaws.com/role-arn: arn:aws:iam::832807087073:role/external-dns-ap-south-1

---
apiVersion: kustomize.toolkit.fluxcd.io/v1beta1
kind: Kustomization
metadata:
  name: monitoring
  namespace: flux-system
spec:
  patchesStrategicMerge:
    - apiVersion: helm.toolkit.fluxcd.io/v2beta1
      kind: HelmRelease
      metadata:
        name: kube-prometheus-stack
        namespace: monitoring
      spec:
        values:
          grafana:
            enabled: true
